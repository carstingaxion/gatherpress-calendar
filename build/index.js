(()=>{"use strict";var e,t={861(){const e=window.wp.blocks,t=window.wp.compose,r=window.wp.hooks,s=window.wp.components,a=window.wp.i18n,n=window.wp.data,o=window.wp.blockEditor,l=window.wp.coreData,d=window.wp.date,i=window.wp.element,c=window.ReactJSXRuntime,h=[["core/post-title",{level:3}],["core/post-date"]];function p(e,t=0){let r;if(e&&/^\d{4}-\d{2}$/.test(e)){const[t,s]=e.split("-").map(Number);r=new Date(t,s-1,1)}else r=new Date,0!==t&&(r.setDate(1),r.setMonth(r.getMonth()+t));return r}function g(e=0){const t=[],r=new Date("2024-01-07");for(let s=0;s<7;s++){const a=(e+s)%7,n=new Date(r);n.setDate(r.getDate()+a),t.push((0,d.dateI18n)("D",n))}return t}function u(e){if(!e)return"";if("string"==typeof e)return e;if("object"==typeof e){const{top:t="0",right:r="0",bottom:s="0",left:a="0"}=e;return`${t} ${r} ${s} ${a}`}return""}function m(e){if(!e)return{};const t={};if(e.width&&(t.borderWidth=e.width),e.style&&(t.borderStyle=e.style),e.color&&(t.borderColor=e.color),e.radius)if("string"==typeof e.radius)t.borderRadius=e.radius;else if("object"==typeof e.radius){const{topLeft:r="0",topRight:s="0",bottomRight:a="0",bottomLeft:n="0"}=e.radius;t.borderRadius=`${r} ${s} ${a} ${n}`}return t}const x=JSON.parse('{"UU":"gatherpress/calendar"}');(0,e.registerBlockType)(x.UU,{edit:function({attributes:e,setAttributes:t,context:r}){const{selectedMonth:x,monthModifier:y=0,templateConfigStyle:_={}}=e,{query:f}=r,[b,w]=(0,i.useState)(!1),j=function(e,t=0){const r=p(e,t);return{year:r.getFullYear(),month:r.getMonth()+1}}(x,y),{posts:v,startOfWeek:C}=(0,n.useSelect)(e=>{if(!f)return{posts:[],startOfWeek:0};const{getEntityRecords:t}=e(l.store),{getSite:r}=e(l.store),s={...f};delete s.gatherpress_event_query,delete s.include_unfinished,"datetime"===s.orderBy&&(s.orderBy="date");const a={per_page:s.perPage||100,order:s.order||"DESC",orderby:s.orderBy||"date",_embed:"wp:term"};j&&j.year&&j.month&&(a.year=j.year,a.month=j.month),s.taxQuery&&Object.keys(s.taxQuery).forEach(e=>{a[e]=s.taxQuery[e]}),s.author&&(a.author=s.author),s.search&&(a.search=s.search);const n=r(),o=n?.start_of_week||0;return{posts:t("postType",s.postType||"post",a)||[],startOfWeek:o}},[f,j]),k=(0,o.useBlockProps)({className:"gatherpress-calendar-block"}),S=(0,o.useInnerBlocksProps)({className:"gatherpress-calendar-template"},{template:h,templateLock:!1});if(!f)return(0,c.jsx)("div",{...k,children:(0,c.jsx)(s.Placeholder,{icon:"calendar-alt",label:(0,a.__)("GatherPress Calendar","gatherpress-calendar"),instructions:(0,a.__)("This block must be used inside a Query Loop block.","gatherpress-calendar")})});const B=function(e,t=0,r="",s=0){const a=p(r,s),n=a.getFullYear(),o=a.getMonth(),l={};e&&e.length>0&&e.forEach(e=>{let t;if(t="gatherpress_event"===e.type?e.meta.gatherpress_datetime_start:e.date,!t)return;const r=new Date(t),s=(0,d.dateI18n)("Y-m-d",r);l[s]||(l[s]=[]),l[s].push(e)});const i=new Date(n,o,1),c=new Date(n,o+1,0).getDate();let h=i.getDay();h=(h-t+7)%7;const u=[];let m=[];for(let e=0;e<h;e++)m.push({isEmpty:!0});for(let e=1;e<=c;e++){const t=`${n}-${String(o+1).padStart(2,"0")}-${String(e).padStart(2,"0")}`,r=l[t]||[];m.push({day:e,date:t,posts:r,isEmpty:!1}),7===m.length&&(u.push(m),m=[])}for(;m.length>0&&m.length<7;)m.push({isEmpty:!0});return m.length>0&&u.push(m),{monthName:(0,d.dateI18n)("F Y",i),weeks:u,dayNames:g(t)}}(v,C,x,y),N=function(){const e=[],t=(new Date).getFullYear();for(let r=t-1;r<=t+1;r++)for(let t=1;t<=12;t++){const s=new Date(r,t-1,1),a=`${r}-${String(t).padStart(2,"0")}`,n=(0,d.dateI18n)("F Y",s);e.push({value:a,label:n})}return e}(),D={backgroundColor:_.backgroundColor||void 0,padding:u(_.padding)||void 0,...m({width:_.borderWidth,style:_.borderStyle,color:_.borderColor,radius:_.borderRadius}),boxShadow:_.boxShadow||void 0};let O;return O=0===y?(0,a.__)("Showing current month","gatherpress-calendar"):y<0?(0,a.sprintf)(/* translators: %d: number of months ago */ /* translators: %d: number of months ago */
(0,a.__)("Showing %d month(s) ago","gatherpress-calendar"),Math.abs(y)):(0,a.sprintf)(/* translators: %d: number of months ahead */ /* translators: %d: number of months ahead */
(0,a.__)("Showing %d month(s) ahead","gatherpress-calendar"),y),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(o.InspectorControls,{children:[(0,c.jsxs)(s.PanelBody,{title:(0,a.__)("Calendar Settings","gatherpress-calendar"),children:[(0,c.jsx)("p",{children:(0,a.__)("Select a specific month to display, or leave empty to show the current month.","gatherpress-calendar")}),b?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{style:{marginBottom:"12px",maxHeight:"200px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px"},children:N.map(e=>(0,c.jsx)(s.Button,{isPressed:x===e.value,onClick:()=>{t({selectedMonth:e.value}),w(!1)},style:{width:"100%",justifyContent:"flex-start",padding:"8px 12px"},children:e.label},e.value))}),(0,c.jsx)(s.Button,{isSecondary:!0,onClick:()=>w(!1),style:{width:"100%"},children:(0,a.__)("Cancel","gatherpress-calendar")})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{style:{marginBottom:"12px",padding:"8px",background:"#f0f0f1",borderRadius:"4px"},children:[(0,c.jsx)("strong",{children:(0,a.__)("Current Selection:","gatherpress-calendar")}),(0,c.jsx)("br",{}),x?N.find(e=>e.value===x)?.label:(0,a.__)("Current Month","gatherpress-calendar"),!x&&0!==y&&(0,c.jsxs)(c.Fragment,{children:[" ",y>0?`+${y}`:y," ",1===y?(0,a.__)("month","gatherpress-calendar"):(0,a.__)("months","gatherpress-calendar")]})]}),(0,c.jsx)(s.Button,{isPrimary:!0,onClick:()=>w(!0),style:{width:"100%",marginBottom:"8px"},children:(0,a.__)("Change Month","gatherpress-calendar")}),x&&(0,c.jsx)(s.Button,{isSecondary:!0,onClick:()=>t({selectedMonth:""}),style:{width:"100%"},children:(0,a.__)("Reset to Current Month","gatherpress-calendar")})]}),!x&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("hr",{style:{margin:"16px 0",borderTop:"1px solid #ddd"}}),(0,c.jsx)("p",{style:{marginTop:"16px",marginBottom:"8px",fontWeight:"500"},children:(0,a.__)("Month Offset","gatherpress-calendar")}),(0,c.jsx)("p",{style:{fontSize:"12px",color:"#757575",marginBottom:"12px"},children:(0,a.__)("Display a month relative to the current month. For example, -1 shows last month, +1 shows next month. The calendar will automatically update as time passes.","gatherpress-calendar")}),(0,c.jsx)(s.__experimentalNumberControl,{label:(0,a.__)("Months from current","gatherpress-calendar"),value:y,onChange:e=>{const r=""===e?0:parseInt(e,10);t({monthModifier:isNaN(r)?0:r})},min:-12,max:12,step:1,help:O}),0!==y&&(0,c.jsx)(s.Button,{isSecondary:!0,onClick:()=>t({monthModifier:0}),style:{width:"100%",marginTop:"8px"},children:(0,a.__)("Reset Month Offset","gatherpress-calendar")})]})]}),(0,c.jsxs)(s.PanelBody,{title:(0,a.__)("Template Style","gatherpress-calendar"),initialOpen:!1,children:[(0,c.jsx)(o.PanelColorSettings,{title:(0,a.__)("Background","gatherpress-calendar"),colorSettings:[{value:_.backgroundColor,onChange:e=>{t({templateConfigStyle:{..._,backgroundColor:e}})},label:(0,a.__)("Background Color","gatherpress-calendar")}]}),(0,c.jsx)(s.BoxControl,{label:(0,a.__)("Padding","gatherpress-calendar"),values:_.padding,onChange:e=>{t({templateConfigStyle:{..._,padding:e}})}}),(0,c.jsx)(s.BorderControl,{label:(0,a.__)("Border","gatherpress-calendar"),value:{width:_.borderWidth,style:_.borderStyle,color:_.borderColor,radius:_.borderRadius},onChange:e=>{t({templateConfigStyle:{..._,borderWidth:e.width,borderStyle:e.style,borderColor:e.color,borderRadius:e.radius}})}}),(0,c.jsx)(s.RangeControl,{label:(0,a.__)("Box Shadow Blur","gatherpress-calendar"),value:parseInt(_.boxShadow?.match(/\d+/)?.[0]||0),onChange:e=>{t({templateConfigStyle:{..._,boxShadow:e>0?`0 8px ${e}px rgba(0, 0, 0, 0.15)`:void 0}})},min:0,max:50})]})]}),(0,c.jsx)("div",{...k,children:(0,c.jsxs)("div",{className:"gatherpress-calendar",children:[(0,c.jsx)("h2",{className:"gatherpress-calendar__month",children:B.monthName}),(0,c.jsxs)("table",{className:"gatherpress-calendar__table",children:[(0,c.jsx)("thead",{children:(0,c.jsx)("tr",{children:B.dayNames.map((e,t)=>(0,c.jsx)("th",{children:e},t))})}),(0,c.jsx)("tbody",{children:B.weeks.map((e,t)=>(0,c.jsx)("tr",{children:e.map((e,t)=>(0,c.jsx)("td",{className:`gatherpress-calendar__day ${e.isEmpty?"is-empty":""} ${e.posts?.length>0?"has-posts":""}`,children:!e.isEmpty&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"gatherpress-calendar__day-number",children:e.day}),e.posts?.length>0&&(0,c.jsx)("div",{className:"gatherpress-calendar__events",children:e.posts.map(e=>(0,c.jsx)("div",{className:"gatherpress-calendar__event",title:e.title?.rendered||(0,a.__)("(No title)","gatherpress-calendar")},e.id))})]})},t))},t))})]}),(0,c.jsxs)("div",{className:"gatherpress-calendar__template-config",style:D,children:[(0,c.jsx)("p",{className:"gatherpress-calendar__template-label",children:(0,a.__)("Configure how events appear in the calendar by adding blocks below:","gatherpress-calendar")}),(0,c.jsx)("div",{...S})]})]})})]})},save:function(){const e=o.useBlockProps.save({className:"gatherpress-calendar-block"}),t=o.useInnerBlocksProps.save({className:"gatherpress-calendar-template"});return(0,c.jsx)("div",{...e,children:(0,c.jsx)("div",{...t})})}});const y=(0,t.createHigherOrderComponent)(e=>t=>{if("core/query"!==t.name)return(0,c.jsx)(e,{...t});const{hasCalendarChild:r,isGatherPressQuery:l}=(0,n.useSelect)(e=>{const{getBlock:r}=e(o.store),s=r(t.clientId);return s&&s.innerBlocks&&0!==s.innerBlocks.length?{hasCalendarChild:s.innerBlocks.some(e=>"gatherpress/calendar"===e.name),isGatherPressQuery:"gatherpress_event"===(s.attributes?.query?.postType||"post")}:{hasCalendarChild:!1,isGatherPressQuery:!1}},[t.clientId]),d=r&&l;return(0,c.jsxs)(c.Fragment,{children:[d&&(0,c.jsx)(o.InspectorControls,{children:(0,c.jsxs)(s.Notice,{status:"info",isDismissible:!1,children:[(0,c.jsx)("p",{children:(0,a.__)('The GatherPress Calendar block is active in this Query Loop. The calendar will use date-based filtering for the selected month, overriding the "Upcoming or past events" setting.',"gatherpress-calendar")}),(0,c.jsx)("p",{children:(0,a.__)("This ensures the calendar only displays events from the specific month, regardless of whether they are past or upcoming events.","gatherpress-calendar")})]})}),(0,c.jsx)(e,{...t})]})},"withCalendarNotice");(0,r.addFilter)("editor.BlockEdit","gatherpress-calendar/with-calendar-notice",y,20)}},r={};function s(e){var a=r[e];if(void 0!==a)return a.exports;var n=r[e]={exports:{}};return t[e](n,n.exports,s),n.exports}s.m=t,e=[],s.O=(t,r,a,n)=>{if(!r){var o=1/0;for(c=0;c<e.length;c++){for(var[r,a,n]=e[c],l=!0,d=0;d<r.length;d++)(!1&n||o>=n)&&Object.keys(s.O).every(e=>s.O[e](r[d]))?r.splice(d--,1):(l=!1,n<o&&(o=n));if(l){e.splice(c--,1);var i=a();void 0!==i&&(t=i)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[r,a,n]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};s.O.j=t=>0===e[t];var t=(t,r)=>{var a,n,[o,l,d]=r,i=0;if(o.some(t=>0!==e[t])){for(a in l)s.o(l,a)&&(s.m[a]=l[a]);if(d)var c=d(s)}for(t&&t(r);i<o.length;i++)n=o[i],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(c)},r=globalThis.webpackChunkgatherpress_calendar=globalThis.webpackChunkgatherpress_calendar||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var a=s.O(void 0,[350],()=>s(861));a=s.O(a)})();