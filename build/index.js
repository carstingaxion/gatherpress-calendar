(()=>{"use strict";var e,t={746(){const e=window.wp.blocks,t=window.wp.compose,r=window.wp.hooks,a=window.wp.components,n=window.wp.i18n,s=window.wp.data,o=window.wp.blockEditor,l=window.wp.element,d=[["core/post-title",{level:3}],["core/post-date"]];function i(e,t=0){let r;if(e&&/^\d{4}-\d{2}$/.test(e)){const[t,a]=e.split("-").map(Number);r=new Date(t,a-1,1)}else r=new Date,0!==t&&(r.setDate(1),r.setMonth(r.getMonth()+t));return r}const h=window.wp.date;function c(e=0){const t=[],r=new Date("2024-01-07");for(let a=0;a<7;a++){const n=(e+a)%7,s=new Date(r);s.setDate(r.getDate()+n),t.push((0,h.dateI18n)("D",s))}return t}function p(){const e=[],t=(new Date).getFullYear();for(let r=t-1;r<=t+1;r++)for(let t=1;t<=12;t++){const a=new Date(r,t-1,1),n=`${r}-${String(t).padStart(2,"0")}`,s=(0,h.dateI18n)("F Y",a);e.push({value:n,label:s})}return e}function g(e){if(!e)return"";if("string"==typeof e)return e;if("object"==typeof e){const{top:t="0",right:r="0",bottom:a="0",left:n="0"}=e;return`${t} ${r} ${a} ${n}`}return""}function u(e){if(!e)return{};const t={};if(e.width&&(t.borderWidth=e.width),e.style&&(t.borderStyle=e.style),e.color&&(t.borderColor=e.color),e.radius)if("string"==typeof e.radius)t.borderRadius=e.radius;else if("object"==typeof e.radius){const{topLeft:r="0",topRight:a="0",bottomRight:n="0",bottomLeft:s="0"}=e.radius;t.borderRadius=`${r} ${a} ${n} ${s}`}return t}const m=window.wp.coreData,x=window.ReactJSXRuntime;function f({selectedMonth:e,onSelect:t,onCancel:r}){const s=(0,l.useMemo)(()=>p(),[]);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{style:{marginBottom:"12px",maxHeight:"200px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px"},children:s.map(r=>(0,x.jsx)(a.Button,{isPressed:e===r.value,onClick:()=>t(r.value),style:{width:"100%",justifyContent:"flex-start",padding:"8px 12px"},children:r.label},r.value))}),(0,x.jsx)(a.Button,{isSecondary:!0,onClick:r,style:{width:"100%"},children:(0,n.__)("Cancel","gatherpress-calendar")})]})}function _({selectedMonth:e,monthModifier:t,onMonthChange:r,onModifierChange:s,onOpenPicker:o}){const d=(0,l.useMemo)(()=>p(),[]),i=function(e){return(0,l.useMemo)(()=>0===e?(0,n.__)("Showing current month","gatherpress-calendar"):e<0?(0,n.sprintf)(/* translators: %d: number of months ago */ /* translators: %d: number of months ago */
(0,n.__)("Showing %d month(s) ago","gatherpress-calendar"),Math.abs(e)):(0,n.sprintf)(/* translators: %d: number of months ahead */ /* translators: %d: number of months ahead */
(0,n.__)("Showing %d month(s) ahead","gatherpress-calendar"),e),[e])}(t);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("div",{style:{marginBottom:"12px",padding:"8px",background:"#f0f0f1",borderRadius:"4px"},children:[(0,x.jsx)("strong",{children:(0,n.__)("Current Selection:","gatherpress-calendar")}),(0,x.jsx)("br",{}),e?d.find(t=>t.value===e)?.label:(0,n.__)("Current Month","gatherpress-calendar"),!e&&0!==t&&(0,x.jsxs)(x.Fragment,{children:[" ",t>0?`+${t}`:t," ",1===t?(0,n.__)("month","gatherpress-calendar"):(0,n.__)("months","gatherpress-calendar")]})]}),(0,x.jsx)(a.Button,{isPrimary:!0,onClick:o,style:{width:"100%",marginBottom:"8px"},children:(0,n.__)("Change Month","gatherpress-calendar")}),e&&(0,x.jsx)(a.Button,{isSecondary:!0,onClick:()=>r(""),style:{width:"100%"},children:(0,n.__)("Reset to Current Month","gatherpress-calendar")}),!e&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("hr",{style:{margin:"16px 0",borderTop:"1px solid #ddd"}}),(0,x.jsx)("p",{style:{marginTop:"16px",marginBottom:"8px",fontWeight:"500"},children:(0,n.__)("Month Offset","gatherpress-calendar")}),(0,x.jsx)("p",{style:{fontSize:"12px",color:"#757575",marginBottom:"12px"},children:(0,n.__)("Display a month relative to the current month. For example, -1 shows last month, +1 shows next month. The calendar will automatically update as time passes.","gatherpress-calendar")}),(0,x.jsx)(a.__experimentalNumberControl,{label:(0,n.__)("Months from current","gatherpress-calendar"),value:t,onChange:s,min:-12,max:12,step:1,help:i}),0!==t&&(0,x.jsx)(a.Button,{isSecondary:!0,onClick:()=>s(0),style:{width:"100%",marginTop:"8px"},children:(0,n.__)("Reset Month Offset","gatherpress-calendar")})]})]})}function y({day:e}){return(0,x.jsx)("td",{className:`gatherpress-calendar__day ${e.isEmpty?"is-empty":""} ${e.posts?.length>0?"has-posts":""}`,children:!e.isEmpty&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{className:"gatherpress-calendar__day-number",children:e.day}),e.posts?.length>0&&(0,x.jsx)("div",{className:"gatherpress-calendar__events",children:e.posts.map(e=>(0,x.jsx)("div",{className:"gatherpress-calendar__event",title:e.title?.rendered||(0,n.__)("(No title)","gatherpress-calendar")},e.id))})]})})}function b({calendar:e}){return(0,x.jsxs)("table",{className:"gatherpress-calendar__table",children:[(0,x.jsx)("thead",{children:(0,x.jsx)("tr",{children:e.dayNames.map((e,t)=>(0,x.jsx)("th",{children:e},t))})}),(0,x.jsx)("tbody",{children:e.weeks.map((e,t)=>(0,x.jsx)("tr",{children:e.map((e,t)=>(0,x.jsx)(y,{day:e},t))},t))})]})}function w({templateConfigStyles:e,innerBlocksProps:t}){return(0,x.jsxs)("div",{className:"gatherpress-calendar__template-config",style:e,children:[(0,x.jsx)("p",{className:"gatherpress-calendar__template-label",children:(0,n.__)("Configure how events appear in the calendar by adding blocks below:","gatherpress-calendar")}),(0,x.jsx)("div",{...t})]})}const j=JSON.parse('{"UU":"gatherpress/calendar"}');(0,e.registerBlockType)(j.UU,{edit:function({attributes:e,setAttributes:t,context:r}){const{selectedMonth:p,monthModifier:y=0,templateConfigStyle:j={},showMonthHeading:v=!0,monthHeadingLevel:C=2}=e,{query:k}=r,[S,M]=(0,l.useState)(!1),B=(0,l.useMemo)(()=>function(e,t=0){const r=i(e,t);return{year:r.getFullYear(),month:r.getMonth()+1}}(p,y),[p,y]),{posts:N,startOfWeek:O}=function(e,t){return(0,s.useSelect)(r=>{if(!e)return{posts:[],startOfWeek:0};const{getEntityRecords:a}=r(m.store),{getSite:n}=r(m.store),s={...e},o={per_page:100,_embed:"wp:term"};t&&t.year&&t.month&&(o.gatherpress_calendar_query=!0,o.year=t.year,o.month=t.month),s.taxQuery&&Object.keys(s.taxQuery).forEach(e=>{o[e]=s.taxQuery[e]}),s.author&&(o.author=s.author),s.search&&(o.search=s.search);const l=n(),d=l?.start_of_week||0;return{posts:a("postType",s.postType||"post",o)||[],startOfWeek:d}},[e,t])}(k,B),P=(0,l.useMemo)(()=>function(e,t=0,r="",a=0){const n=i(r,a),s=n.getFullYear(),o=n.getMonth(),l={};e&&e.length>0&&e.forEach(e=>{let t;if(t="gatherpress_event"===e.type?e.meta.gatherpress_datetime_start:e.date,!t)return;const r=new Date(t),a=(0,h.dateI18n)("Y-m-d",r);l[a]||(l[a]=[]),l[a].push(e)});const d=new Date(s,o,1),p=new Date(s,o+1,0).getDate();let g=d.getDay();g=(g-t+7)%7;const u=[];let m=[];for(let e=0;e<g;e++)m.push({isEmpty:!0});for(let e=1;e<=p;e++){const t=`${s}-${String(o+1).padStart(2,"0")}-${String(e).padStart(2,"0")}`,r=l[t]||[];m.push({day:e,date:t,posts:r,isEmpty:!1}),7===m.length&&(u.push(m),m=[])}for(;m.length>0&&m.length<7;)m.push({isEmpty:!0});return m.length>0&&u.push(m),{monthName:(0,h.dateI18n)("F Y",d),weeks:u,dayNames:c(t)}}(N,O,p,y),[N,O,p,y]),D=(0,l.useMemo)(()=>{if(!v)return null;const e=Math.max(1,Math.min(6,C));return(0,l.createElement)(`h${e}`,{className:"gatherpress-calendar__month"},P.monthName)},[v,C,P.monthName]),$=(0,o.useBlockProps)({className:"gatherpress-calendar-block"}),T=(0,o.useInnerBlocksProps)({className:"gatherpress-calendar-template"},{template:d,templateLock:!1});if(!k)return(0,x.jsx)("div",{...$,children:(0,x.jsx)(a.Placeholder,{icon:"calendar-alt",label:(0,n.__)("GatherPress Calendar","gatherpress-calendar"),instructions:(0,n.__)("This block must be used inside a Query Loop block.","gatherpress-calendar")})});const R={backgroundColor:j.backgroundColor||void 0,padding:g(j.padding)||void 0,...u({width:j.borderWidth,style:j.borderStyle,color:j.borderColor,radius:j.borderRadius}),boxShadow:j.boxShadow||void 0};return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(o.InspectorControls,{children:[(0,x.jsxs)(a.PanelBody,{title:(0,n.__)("Calendar Settings","gatherpress-calendar"),children:[(0,x.jsx)("p",{children:(0,n.__)("Select a specific month to display, or leave empty to show the current month.","gatherpress-calendar")}),S?(0,x.jsx)(f,{selectedMonth:p,onSelect:e=>{t({selectedMonth:e}),M(!1)},onCancel:()=>M(!1)}):(0,x.jsx)(_,{selectedMonth:p,monthModifier:y,onMonthChange:e=>{t({selectedMonth:e})},onModifierChange:e=>{const r=""===e?0:parseInt(e,10);t({monthModifier:isNaN(r)?0:r})},onOpenPicker:()=>M(!0)}),(0,x.jsx)("hr",{style:{margin:"16px 0",borderTop:"1px solid #ddd"}}),(0,x.jsx)(a.ToggleControl,{label:(0,n.__)("Show Month Heading","gatherpress-calendar"),checked:v,onChange:e=>t({showMonthHeading:e}),help:(0,n.__)("Display the month name and year above the calendar.","gatherpress-calendar")}),v&&(0,x.jsx)(a.RangeControl,{label:(0,n.__)("Heading Level","gatherpress-calendar"),value:C,onChange:e=>t({monthHeadingLevel:e||2}),min:1,max:6,step:1,help:(0,n.__)("Select the HTML heading level (h1-h6) for the month name.","gatherpress-calendar")})]}),(0,x.jsxs)(a.PanelBody,{title:(0,n.__)("Template Style","gatherpress-calendar"),initialOpen:!1,children:[(0,x.jsx)(o.PanelColorSettings,{title:(0,n.__)("Background","gatherpress-calendar"),colorSettings:[{value:j.backgroundColor,onChange:e=>{t({templateConfigStyle:{...j,backgroundColor:e}})},label:(0,n.__)("Background Color","gatherpress-calendar")}]}),(0,x.jsx)(a.BoxControl,{label:(0,n.__)("Padding","gatherpress-calendar"),values:j.padding,onChange:e=>{t({templateConfigStyle:{...j,padding:e}})}}),(0,x.jsx)(a.BorderControl,{label:(0,n.__)("Border","gatherpress-calendar"),value:{width:j.borderWidth,style:j.borderStyle,color:j.borderColor,radius:j.borderRadius},onChange:e=>{t({templateConfigStyle:{...j,borderWidth:e.width,borderStyle:e.style,borderColor:e.color,borderRadius:e.radius}})}}),(0,x.jsx)(a.RangeControl,{label:(0,n.__)("Box Shadow Blur","gatherpress-calendar"),value:parseInt(j.boxShadow?.match(/\d+/)?.[0]||0),onChange:e=>{t({templateConfigStyle:{...j,boxShadow:e>0?`0 8px ${e}px rgba(0, 0, 0, 0.15)`:void 0}})},min:0,max:50})]})]}),(0,x.jsx)("div",{...$,children:(0,x.jsxs)("div",{className:"gatherpress-calendar",children:[D,(0,x.jsx)(b,{calendar:P}),(0,x.jsx)(w,{templateConfigStyles:R,innerBlocksProps:T})]})})]})},save:function(){const e=o.useBlockProps.save({className:"gatherpress-calendar-block"}),t=o.useInnerBlocksProps.save({className:"gatherpress-calendar-template"});return(0,x.jsx)("div",{...e,children:(0,x.jsx)("div",{...t})})}});const v=(0,t.createHigherOrderComponent)(e=>t=>{if("core/query"!==t.name)return(0,x.jsx)(e,{...t});const{hasCalendarChild:r,isGatherPressQuery:l}=(0,s.useSelect)(e=>{const{getBlock:r}=e(o.store),a=r(t.clientId);return a&&a.innerBlocks&&0!==a.innerBlocks.length?{hasCalendarChild:a.innerBlocks.some(e=>"gatherpress/calendar"===e.name),isGatherPressQuery:"gatherpress_event"===(a.attributes?.query?.postType||"post")}:{hasCalendarChild:!1,isGatherPressQuery:!1}},[t.clientId]),d=r&&l;return(0,x.jsxs)(x.Fragment,{children:[d&&(0,x.jsx)(o.InspectorControls,{children:(0,x.jsxs)(a.Notice,{status:"info",isDismissible:!1,children:[(0,x.jsx)("p",{children:(0,n.__)('The GatherPress Calendar block is active in this Query Loop. The calendar will use date-based filtering for the selected month, overriding the "Upcoming or past events" setting.',"gatherpress-calendar")}),(0,x.jsx)("p",{children:(0,n.__)("This ensures the calendar only displays events from the specific month, regardless of whether they are past or upcoming events.","gatherpress-calendar")})]})}),(0,x.jsx)(e,{...t})]})},"withCalendarNotice");(0,r.addFilter)("editor.BlockEdit","gatherpress-calendar/with-calendar-notice",v,20)}},r={};function a(e){var n=r[e];if(void 0!==n)return n.exports;var s=r[e]={exports:{}};return t[e](s,s.exports,a),s.exports}a.m=t,e=[],a.O=(t,r,n,s)=>{if(!r){var o=1/0;for(h=0;h<e.length;h++){for(var[r,n,s]=e[h],l=!0,d=0;d<r.length;d++)(!1&s||o>=s)&&Object.keys(a.O).every(e=>a.O[e](r[d]))?r.splice(d--,1):(l=!1,s<o&&(o=s));if(l){e.splice(h--,1);var i=n();void 0!==i&&(t=i)}}return t}s=s||0;for(var h=e.length;h>0&&e[h-1][2]>s;h--)e[h]=e[h-1];e[h]=[r,n,s]},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};a.O.j=t=>0===e[t];var t=(t,r)=>{var n,s,[o,l,d]=r,i=0;if(o.some(t=>0!==e[t])){for(n in l)a.o(l,n)&&(a.m[n]=l[n]);if(d)var h=d(a)}for(t&&t(r);i<o.length;i++)s=o[i],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(h)},r=globalThis.webpackChunkgatherpress_calendar=globalThis.webpackChunkgatherpress_calendar||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var n=a.O(void 0,[350],()=>a(746));n=a.O(n)})();