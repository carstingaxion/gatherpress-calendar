{"version":3,"file":"view.js","mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC,YAAW;EACX,YAAY;;EAEZ;AACD;AACA;AACA;AACA;AACA;EACC,IAAIA,aAAa,GAAG,IAAI;;EAExB;AACD;AACA;AACA;AACA;AACA;EACC,IAAIC,cAAc,GAAG,IAAI;;EAEzB;AACD;AACA;AACA;AACA;AACA;EACC,IAAIC,cAAc,GAAG,IAAI;;EAEzB;AACD;AACA;AACA;AACA;AACA;EACC,IAAIC,QAAQ,GAAG,IAAI;;EAEnB;AACD;AACA;AACA;AACA;AACA;EACC,MAAMC,aAAa,GAAG,IAAIC,OAAO,CAAC,CAAC;;EAEnC;EACA,IAAIC,QAAQ,CAACC,UAAU,KAAK,SAAS,EAAE;IACtCD,QAAQ,CAACE,gBAAgB,CAAC,kBAAkB,EAAEC,IAAI,CAAC;EACpD,CAAC,MAAM;IACNA,IAAI,CAAC,CAAC;EACP;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACC,SAASA,IAAIA,CAAA,EAAG;IACf,MAAMC,SAAS,GAAGJ,QAAQ,CAACK,gBAAgB,CAAC,uBAAuB,CAAC;IACpE,IAAI,CAACD,SAAS,CAACE,MAAM,EAAE;;IAEvB;IACA,IAAI,sBAAsB,IAAIC,MAAM,EAAE;MACrCC,yBAAyB,CAACJ,SAAS,CAAC;IACrC,CAAC,MAAM;MACN;MACA;MACAA,SAAS,CAACK,OAAO,CAAC,UAASC,QAAQ,EAAE;QACpCZ,aAAa,CAACa,GAAG,CAACD,QAAQ,EAAE,IAAI,CAAC;QACjCE,aAAa,CAACF,QAAQ,CAAC;MACxB,CAAC,CAAC;IACH;;IAEA;IACAV,QAAQ,CAACE,gBAAgB,CAAC,SAAS,EAAE,UAASW,CAAC,EAAE;MAChD,IAAIA,CAAC,CAACC,GAAG,KAAK,QAAQ,IAAIpB,aAAa,EAAE;QACxCqB,YAAY,CAAC,CAAC;MACf;IACD,CAAC,CAAC;EACH;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACC,SAASP,yBAAyBA,CAACJ,SAAS,EAAE;IAC7CP,QAAQ,GAAG,IAAImB,oBAAoB,CAClC,UAASC,OAAO,EAAE;MACjBA,OAAO,CAACR,OAAO,CAAC,UAASS,KAAK,EAAE;QAC/B,MAAMR,QAAQ,GAAGQ,KAAK,CAACC,MAAM;QAC7B,MAAMC,UAAU,GAAGtB,aAAa,CAACuB,GAAG,CAACX,QAAQ,CAAC;QAC9C,MAAMY,SAAS,GAAGJ,KAAK,CAACK,cAAc;;QAEtC;QACAzB,aAAa,CAACa,GAAG,CAACD,QAAQ,EAAEY,SAAS,CAAC;QAEtC,IAAIA,SAAS,IAAI,CAACF,UAAU,EAAE;UAC7B;UACAR,aAAa,CAACF,QAAQ,CAAC;QACxB,CAAC,MAAM,IAAI,CAACY,SAAS,IAAIF,UAAU,EAAE;UACpC;UACA;UACA,IAAIxB,cAAc,KAAKc,QAAQ,EAAE;YAChCK,YAAY,CAAC,CAAC;UACf;UACA;QACD;MACD,CAAC,CAAC;IACH,CAAC,EACD;MACC;MACA;MACA;MACAS,SAAS,EAAE,GAAG;MACdC,UAAU,EAAE;IACb,CACD,CAAC;;IAED;IACArB,SAAS,CAACK,OAAO,CAAC,UAASC,QAAQ,EAAE;MACpCZ,aAAa,CAACa,GAAG,CAACD,QAAQ,EAAE,KAAK,CAAC;MAClCb,QAAQ,CAAC6B,OAAO,CAAChB,QAAQ,CAAC;IAC3B,CAAC,CAAC;EACH;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACC,SAASE,aAAaA,CAACF,QAAQ,EAAE;IAChC,MAAMiB,MAAM,GAAGjB,QAAQ,CAACL,gBAAgB,CAAC,8BAA8B,CAAC;IAExEsB,MAAM,CAAClB,OAAO,CAAC,UAASmB,SAAS,EAAE;MAClC;MACA,IAAIA,SAAS,CAACC,YAAY,CAAC,YAAY,CAAC,EAAE;MAC1CD,SAAS,CAACE,YAAY,CAAC,YAAY,EAAE,MAAM,CAAC;;MAE5C;MACAF,SAAS,CAACE,YAAY,CAAC,MAAM,EAAE,QAAQ,CAAC;MACxCF,SAAS,CAACE,YAAY,CAAC,UAAU,EAAE,GAAG,CAAC;;MAEvC;AACH;AACA;AACA;MACGF,SAAS,CAAC1B,gBAAgB,CAAC,OAAO,EAAE,UAASW,CAAC,EAAE;QAC/C;QACA,IAAI,CAACf,aAAa,CAACuB,GAAG,CAACX,QAAQ,CAAC,EAAE;QAElCG,CAAC,CAACkB,cAAc,CAAC,CAAC;QAClBlB,CAAC,CAACmB,eAAe,CAAC,CAAC;QACnBC,WAAW,CAACL,SAAS,EAAElB,QAAQ,CAAC;MACjC,CAAC,CAAC;;MAEF;AACH;AACA;AACA;AACA;MACGkB,SAAS,CAAC1B,gBAAgB,CAAC,SAAS,EAAE,UAASW,CAAC,EAAE;QACjD;QACA,IAAI,CAACf,aAAa,CAACuB,GAAG,CAACX,QAAQ,CAAC,EAAE;QAElC,IAAIG,CAAC,CAACC,GAAG,KAAK,OAAO,IAAID,CAAC,CAACC,GAAG,KAAK,GAAG,EAAE;UACvCD,CAAC,CAACkB,cAAc,CAAC,CAAC;UAClBE,WAAW,CAACL,SAAS,EAAElB,QAAQ,CAAC;QACjC;MACD,CAAC,CAAC;IACH,CAAC,CAAC;EACH;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACC,SAASuB,WAAWA,CAACL,SAAS,EAAElB,QAAQ,EAAE;IACzC;IACA,IAAIhB,aAAa,EAAEqB,YAAY,CAAC,CAAC;;IAEjC;IACA,MAAMmB,OAAO,GAAGN,SAAS,CAACO,SAAS;IACnC,MAAMC,WAAW,GAAGR,SAAS,CAACS,YAAY,CAAC,oBAAoB,CAAC,IAAI,EAAE;;IAEtE;IACA,MAAMC,QAAQ,GAAGtC,QAAQ,CAACuC,aAAa,CAAC,KAAK,CAAC;IAC9CD,QAAQ,CAACE,SAAS,GAAG,gCAAgC;IACrDF,QAAQ,CAACpC,gBAAgB,CAAC,OAAO,EAAEa,YAAY,CAAC;IAChDf,QAAQ,CAACyC,IAAI,CAACC,WAAW,CAACJ,QAAQ,CAAC;;IAEnC;IACA,MAAMK,OAAO,GAAG3C,QAAQ,CAACuC,aAAa,CAAC,KAAK,CAAC;IAC7CI,OAAO,CAACH,SAAS,GAAG,+BAA+B;IACnDG,OAAO,CAACb,YAAY,CAAC,MAAM,EAAE,QAAQ,CAAC;IACtCa,OAAO,CAACb,YAAY,CAAC,YAAY,EAAE,MAAM,CAAC;IAC1C,IAAIM,WAAW,EAAE;MAChBO,OAAO,CAACb,YAAY,CAAC,OAAO,EAAEM,WAAW,CAAC;IAC3C;;IAEA;IACA,MAAMQ,QAAQ,GAAG5C,QAAQ,CAACuC,aAAa,CAAC,QAAQ,CAAC;IACjDK,QAAQ,CAACJ,SAAS,GAAG,qCAAqC;IAC1DI,QAAQ,CAACT,SAAS,GAAG,SAAS;IAC9BS,QAAQ,CAACd,YAAY,CAAC,YAAY,EAAE,OAAO,CAAC;IAC5Cc,QAAQ,CAAC1C,gBAAgB,CAAC,OAAO,EAAEa,YAAY,CAAC;;IAEhD;IACA4B,OAAO,CAACR,SAAS,GAAGD,OAAO;IAC3BS,OAAO,CAACD,WAAW,CAACE,QAAQ,CAAC;IAC7B5C,QAAQ,CAACyC,IAAI,CAACC,WAAW,CAACC,OAAO,CAAC;;IAElC;IACAE,eAAe,CAACF,OAAO,EAAEf,SAAS,CAAC;;IAEnC;IACA;IACAkB,UAAU,CAAC,YAAW;MACrBR,QAAQ,CAACS,SAAS,CAACC,GAAG,CAAC,WAAW,CAAC;MACnCL,OAAO,CAACI,SAAS,CAACC,GAAG,CAAC,WAAW,CAAC;IACnC,CAAC,EAAE,EAAE,CAAC;;IAEN;IACAtD,aAAa,GAAGiD,OAAO;IACvBhD,cAAc,GAAG2C,QAAQ;IACzB1C,cAAc,GAAGc,QAAQ;;IAEzB;IACAiC,OAAO,CAACM,KAAK,CAAC,CAAC;;IAEf;AACF;AACA;AACA;AACA;AACA;AACA;IACE,MAAMC,SAAS,GAAG,SAAAA,CAAA,EAAW;MAC5B,IAAIxD,aAAa,IAAII,aAAa,CAACuB,GAAG,CAACX,QAAQ,CAAC,EAAE;QACjDmC,eAAe,CAACF,OAAO,EAAEf,SAAS,CAAC;MACpC;IACD,CAAC;;IAED;IACA;IACArB,MAAM,CAACL,gBAAgB,CAAC,QAAQ,EAAEgD,SAAS,EAAE;MAAEC,OAAO,EAAE;IAAK,CAAC,CAAC;IAC/D5C,MAAM,CAACL,gBAAgB,CAAC,QAAQ,EAAEgD,SAAS,EAAE;MAAEC,OAAO,EAAE;IAAK,CAAC,CAAC;;IAE/D;IACAR,OAAO,CAACS,QAAQ,GAAG,YAAW;MAC7B7C,MAAM,CAAC8C,mBAAmB,CAAC,QAAQ,EAAEH,SAAS,CAAC;MAC/C3C,MAAM,CAAC8C,mBAAmB,CAAC,QAAQ,EAAEH,SAAS,CAAC;IAChD,CAAC;EACF;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACC,SAASL,eAAeA,CAACF,OAAO,EAAEf,SAAS,EAAE;IAC5C,MAAM0B,QAAQ,GAAG1B,SAAS,CAAC2B,qBAAqB,CAAC,CAAC;IAClD,MAAMC,OAAO,GAAGb,OAAO,CAACY,qBAAqB,CAAC,CAAC;IAC/C,MAAME,EAAE,GAAGlD,MAAM,CAACmD,UAAU;IAC5B,MAAMC,EAAE,GAAGpD,MAAM,CAACqD,WAAW;IAC7B,MAAMC,GAAG,GAAG,EAAE;;IAEd;IACA,IAAIC,GAAG,GAAGR,QAAQ,CAACS,MAAM,GAAGF,GAAG;IAC/B;IACA,IAAIG,IAAI,GAAGV,QAAQ,CAACU,IAAI,GAAGV,QAAQ,CAACW,KAAK,GAAG,CAAC,GAAGT,OAAO,CAACS,KAAK,GAAG,CAAC;;IAEjE;IACA,IAAID,IAAI,GAAGH,GAAG,EAAEG,IAAI,GAAGH,GAAG;IAC1B,IAAIG,IAAI,GAAGR,OAAO,CAACS,KAAK,GAAGR,EAAE,GAAGI,GAAG,EAAEG,IAAI,GAAGP,EAAE,GAAGD,OAAO,CAACS,KAAK,GAAGJ,GAAG;;IAEpE;IACA;IACA,IAAIC,GAAG,GAAGN,OAAO,CAACU,MAAM,GAAGP,EAAE,GAAGE,GAAG,EAAE;MACpCC,GAAG,GAAGR,QAAQ,CAACQ,GAAG,GAAGN,OAAO,CAACU,MAAM,GAAGL,GAAG;IAC1C;IACA;IACA,IAAIC,GAAG,GAAGD,GAAG,EAAEC,GAAG,GAAGD,GAAG;;IAExB;IACAlB,OAAO,CAACwB,KAAK,CAACL,GAAG,GAAGA,GAAG,GAAG,IAAI;IAC9BnB,OAAO,CAACwB,KAAK,CAACH,IAAI,GAAGA,IAAI,GAAG,IAAI;EACjC;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACC,SAASjD,YAAYA,CAAA,EAAG;IACvB,IAAI,CAACrB,aAAa,EAAE;;IAEpB;IACA,IAAIA,aAAa,CAAC0D,QAAQ,EAAE1D,aAAa,CAAC0D,QAAQ,CAAC,CAAC;;IAEpD;IACA1D,aAAa,CAACqD,SAAS,CAACqB,MAAM,CAAC,WAAW,CAAC;IAC3C,IAAIzE,cAAc,EAAEA,cAAc,CAACoD,SAAS,CAACqB,MAAM,CAAC,WAAW,CAAC;;IAEhE;IACAtB,UAAU,CAAC,YAAW;MACrB,IAAIpD,aAAa,IAAIA,aAAa,CAAC2E,UAAU,EAAE;QAC9C3E,aAAa,CAAC2E,UAAU,CAACC,WAAW,CAAC5E,aAAa,CAAC;MACpD;MACA,IAAIC,cAAc,IAAIA,cAAc,CAAC0E,UAAU,EAAE;QAChD1E,cAAc,CAAC0E,UAAU,CAACC,WAAW,CAAC3E,cAAc,CAAC;MACtD;MACAD,aAAa,GAAG,IAAI;MACpBC,cAAc,GAAG,IAAI;MACrBC,cAAc,GAAG,IAAI;IACtB,CAAC,EAAE,GAAG,CAAC;EACR;AACD,CAAC,EAAE,CAAC,C","sources":["webpack://block-gatherpress-calendar/./src/view.js"],"sourcesContent":["/**\n * GatherPress Calendar Block Frontend Script\n *\n * Progressive enhancement for the GatherPress Calendar block.\n * This script adds interactive popover functionality to event dots,\n * but the calendar remains fully functional without JavaScript.\n *\n * Progressive Enhancement Strategy:\n * - Without JS: Event dots are clickable <a> links that navigate to posts\n * - With JS: preventDefault on click, show popover overlay with post content\n * - Keyboard accessible: Enter/Space to open, Escape to close\n * - Focus management: Popover receives focus when opened\n * - Backdrop click: Clicking outside closes popover\n *\n * Performance Optimization:\n * - Uses IntersectionObserver to only process visible calendars\n * - Pauses event handling when calendar is off-screen\n * - Reduces battery drain on mobile devices\n * - Improves performance on pages with multiple calendars\n *\n * Why minimal JavaScript:\n * - Core functionality works without JS (links)\n * - Better performance on slow connections\n * - Improved accessibility baseline\n * - Graceful degradation for JS-disabled browsers\n *\n * @package GatherPressCalendar\n * @since 0.1.0\n */\n\n(function() {\n\t'use strict';\n\n\t/**\n\t * Active popover element reference.\n\t * Used to track which popover is currently open and close it when needed.\n\t *\n\t * @type {HTMLElement|null}\n\t */\n\tlet activePopover = null;\n\n\t/**\n\t * Active backdrop element reference.\n\t * The semi-transparent overlay behind the popover.\n\t *\n\t * @type {HTMLElement|null}\n\t */\n\tlet activeBackdrop = null;\n\n\t/**\n\t * Active calendar reference.\n\t * Tracks which calendar currently has an open popover.\n\t *\n\t * @type {HTMLElement|null}\n\t */\n\tlet activeCalendar = null;\n\n\t/**\n\t * IntersectionObserver instance for monitoring calendar visibility.\n\t * Used to optimize performance by only processing visible calendars.\n\t *\n\t * @type {IntersectionObserver|null}\n\t */\n\tlet observer = null;\n\n\t/**\n\t * Map of calendars to their visibility state.\n\t * Tracks whether each calendar is currently in the viewport.\n\t *\n\t * @type {WeakMap<HTMLElement, boolean>}\n\t */\n\tconst visibilityMap = new WeakMap();\n\n\t// Initialize when DOM is ready\n\tif (document.readyState === 'loading') {\n\t\tdocument.addEventListener('DOMContentLoaded', init);\n\t} else {\n\t\tinit();\n\t}\n\n\t/**\n\t * Initialize popover functionality for all calendars on the page.\n\t *\n\t * Sets up:\n\t * - IntersectionObserver for visibility tracking\n\t * - Event handlers for visible calendars only\n\t * - Global keyboard handlers (Escape)\n\t *\n\t * @since 0.1.0\n\t *\n\t * @return {void}\n\t */\n\tfunction init() {\n\t\tconst calendars = document.querySelectorAll('.gatherpress-calendar');\n\t\tif (!calendars.length) return;\n\n\t\t// Set up IntersectionObserver to track calendar visibility\n\t\tif ('IntersectionObserver' in window) {\n\t\t\tsetupIntersectionObserver(calendars);\n\t\t} else {\n\t\t\t// Fallback for browsers without IntersectionObserver support\n\t\t\t// Set all calendars as visible and set them up immediately\n\t\t\tcalendars.forEach(function(calendar) {\n\t\t\t\tvisibilityMap.set(calendar, true);\n\t\t\t\tsetupCalendar(calendar);\n\t\t\t});\n\t\t}\n\n\t\t// Global escape key handler to close any open popover\n\t\tdocument.addEventListener('keydown', function(e) {\n\t\t\tif (e.key === 'Escape' && activePopover) {\n\t\t\t\tclosePopover();\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Set up IntersectionObserver to track calendar visibility.\n\t *\n\t * The observer watches for calendars entering/leaving the viewport\n\t * and enables/disables event handlers accordingly. This provides:\n\t * - Better performance by reducing event handler overhead\n\t * - Lower battery consumption on mobile devices\n\t * - Automatic cleanup when calendars scroll off-screen\n\t *\n\t * Threshold: 0.1 means calendar is considered visible when\n\t * at least 10% of it is in the viewport.\n\t *\n\t * @since 0.1.0\n\t *\n\t * @param {NodeList} calendars - List of calendar elements to observe.\n\t *\n\t * @return {void}\n\t */\n\tfunction setupIntersectionObserver(calendars) {\n\t\tobserver = new IntersectionObserver(\n\t\t\tfunction(entries) {\n\t\t\t\tentries.forEach(function(entry) {\n\t\t\t\t\tconst calendar = entry.target;\n\t\t\t\t\tconst wasVisible = visibilityMap.get(calendar);\n\t\t\t\t\tconst isVisible = entry.isIntersecting;\n\n\t\t\t\t\t// Update visibility state\n\t\t\t\t\tvisibilityMap.set(calendar, isVisible);\n\n\t\t\t\t\tif (isVisible && !wasVisible) {\n\t\t\t\t\t\t// Calendar entered viewport - set it up\n\t\t\t\t\t\tsetupCalendar(calendar);\n\t\t\t\t\t} else if (!isVisible && wasVisible) {\n\t\t\t\t\t\t// Calendar left viewport\n\t\t\t\t\t\t// If this calendar has an active popover, close it\n\t\t\t\t\t\tif (activeCalendar === calendar) {\n\t\t\t\t\t\t\tclosePopover();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Event handlers remain but only fire for visible calendars\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t{\n\t\t\t\t// Options:\n\t\t\t\t// - threshold: 0.1 means trigger when 10% visible\n\t\t\t\t// - rootMargin: '50px' gives a buffer zone for smoother transitions\n\t\t\t\tthreshold: 0.1,\n\t\t\t\trootMargin: '50px'\n\t\t\t}\n\t\t);\n\n\t\t// Start observing all calendars\n\t\tcalendars.forEach(function(calendar) {\n\t\t\tvisibilityMap.set(calendar, false);\n\t\t\tobserver.observe(calendar);\n\t\t});\n\t}\n\n\t/**\n\t * Setup event handlers for a single calendar.\n\t *\n\t * Iterates through all event dots in the calendar and attaches:\n\t * - Click handler (prevents default navigation)\n\t * - Keyboard handler (Enter/Space keys)\n\t * - ARIA attributes for accessibility\n\t *\n\t * Event handlers check visibility state before processing,\n\t * providing automatic optimization via IntersectionObserver.\n\t *\n\t * @since 0.1.0\n\t *\n\t * @param {HTMLElement} calendar - The calendar container element.\n\t *\n\t * @return {void}\n\t */\n\tfunction setupCalendar(calendar) {\n\t\tconst events = calendar.querySelectorAll('.gatherpress-calendar__event');\n\n\t\tevents.forEach(function(eventLink) {\n\t\t\t// Skip if already set up (prevents duplicate handlers)\n\t\t\tif (eventLink.hasAttribute('data-setup')) return;\n\t\t\teventLink.setAttribute('data-setup', 'true');\n\n\t\t\t// Add ARIA attributes for screen readers\n\t\t\teventLink.setAttribute('role', 'button');\n\t\t\teventLink.setAttribute('tabindex', '0');\n\n\t\t\t/**\n\t\t\t * Click handler - prevent navigation, show popover.\n\t\t\t * Only processes if calendar is visible (optimization).\n\t\t\t */\n\t\t\teventLink.addEventListener('click', function(e) {\n\t\t\t\t// Check if calendar is visible before processing\n\t\t\t\tif (!visibilityMap.get(calendar)) return;\n\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\tshowPopover(eventLink, calendar);\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * Keyboard support for accessibility.\n\t\t\t * Enter and Space keys trigger the same action as click.\n\t\t\t * Only processes if calendar is visible.\n\t\t\t */\n\t\t\teventLink.addEventListener('keydown', function(e) {\n\t\t\t\t// Check if calendar is visible before processing\n\t\t\t\tif (!visibilityMap.get(calendar)) return;\n\n\t\t\t\tif (e.key === 'Enter' || e.key === ' ') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tshowPopover(eventLink, calendar);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Show popover with event content.\n\t *\n\t * Creates and displays a popover overlay containing the event's inner blocks content.\n\t * The popover is positioned near the clicked event dot and includes:\n\t * - Post content from inner blocks (title, date, excerpt, etc.)\n\t * - Close button (Ã—)\n\t * - Custom styling from templateConfigStyle attribute\n\t *\n\t * Position calculation:\n\t * - Default: Below the event dot with 10px gap\n\t * - If no space below: Above the event dot\n\t * - Horizontally centered on the dot\n\t * - Constrained to viewport with 10px margins\n\t *\n\t * @since 0.1.0\n\t *\n\t * @param {HTMLAnchorElement} eventLink - The event dot link element that was clicked.\n\t * @param {HTMLElement} calendar - The calendar container element.\n\t *\n\t * @return {void}\n\t *\n\t * @example\n\t * // Event link structure:\n\t * // <a class=\"gatherpress-calendar__event\" data-popover-style=\"...\">\n\t * //   <div>Post Title</div>\n\t * //   <div>Post Date</div>\n\t * // </a>\n\t */\n\tfunction showPopover(eventLink, calendar) {\n\t\t// Close any existing popover first\n\t\tif (activePopover) closePopover();\n\n\t\t// Extract content and custom styling\n\t\tconst content = eventLink.innerHTML;\n\t\tconst customStyle = eventLink.getAttribute('data-popover-style') || '';\n\n\t\t// Create backdrop (semi-transparent overlay)\n\t\tconst backdrop = document.createElement('div');\n\t\tbackdrop.className = 'gatherpress-calendar__backdrop';\n\t\tbackdrop.addEventListener('click', closePopover);\n\t\tdocument.body.appendChild(backdrop);\n\n\t\t// Create popover container\n\t\tconst popover = document.createElement('div');\n\t\tpopover.className = 'gatherpress-calendar__popover';\n\t\tpopover.setAttribute('role', 'dialog');\n\t\tpopover.setAttribute('aria-modal', 'true');\n\t\tif (customStyle) {\n\t\t\tpopover.setAttribute('style', customStyle);\n\t\t}\n\n\t\t// Create close button\n\t\tconst closeBtn = document.createElement('button');\n\t\tcloseBtn.className = 'gatherpress-calendar__popover-close';\n\t\tcloseBtn.innerHTML = '&times;';\n\t\tcloseBtn.setAttribute('aria-label', 'Close');\n\t\tcloseBtn.addEventListener('click', closePopover);\n\n\t\t// Add content and close button to popover\n\t\tpopover.innerHTML = content;\n\t\tpopover.appendChild(closeBtn);\n\t\tdocument.body.appendChild(popover);\n\n\t\t// Position popover near the event dot\n\t\tpositionPopover(popover, eventLink);\n\n\t\t// Animate in (fade transition)\n\t\t// Small delay allows browser to calculate dimensions before transitioning\n\t\tsetTimeout(function() {\n\t\t\tbackdrop.classList.add('is-active');\n\t\t\tpopover.classList.add('is-active');\n\t\t}, 10);\n\n\t\t// Store references for cleanup\n\t\tactivePopover = popover;\n\t\tactiveBackdrop = backdrop;\n\t\tactiveCalendar = calendar;\n\t\t\n\t\t// Move focus to popover for keyboard navigation\n\t\tpopover.focus();\n\n\t\t/**\n\t\t * Setup position update handler.\n\t\t *\n\t\t * Only updates position when the calendar is visible.\n\t\t * This optimization prevents unnecessary calculations when\n\t\t * the calendar (and thus the popover) is off-screen.\n\t\t */\n\t\tconst updatePos = function() {\n\t\t\tif (activePopover && visibilityMap.get(calendar)) {\n\t\t\t\tpositionPopover(popover, eventLink);\n\t\t\t}\n\t\t};\n\n\t\t// Update position on scroll and resize\n\t\t// These fire frequently, but updatePos checks visibility first\n\t\twindow.addEventListener('scroll', updatePos, { passive: true });\n\t\twindow.addEventListener('resize', updatePos, { passive: true });\n\t\t\n\t\t// Store cleanup function for later\n\t\tpopover._cleanup = function() {\n\t\t\twindow.removeEventListener('scroll', updatePos);\n\t\t\twindow.removeEventListener('resize', updatePos);\n\t\t};\n\t}\n\n\t/**\n\t * Position popover near the event dot.\n\t *\n\t * Calculates optimal position for the popover based on:\n\t * - Event dot location\n\t * - Viewport dimensions\n\t * - Popover dimensions\n\t *\n\t * Positioning logic:\n\t * 1. Center horizontally on the dot\n\t * 2. Place below dot with 10px gap (default)\n\t * 3. If no space below, place above dot\n\t * 4. Constrain to viewport with 10px margins\n\t *\n\t * @since 0.1.0\n\t *\n\t * @param {HTMLElement} popover - The popover element to position.\n\t * @param {HTMLElement} eventLink - The event dot link element.\n\t *\n\t * @return {void}\n\t */\n\tfunction positionPopover(popover, eventLink) {\n\t\tconst linkRect = eventLink.getBoundingClientRect();\n\t\tconst popRect = popover.getBoundingClientRect();\n\t\tconst vw = window.innerWidth;\n\t\tconst vh = window.innerHeight;\n\t\tconst gap = 10;\n\n\t\t// Start with popover below the dot\n\t\tlet top = linkRect.bottom + gap;\n\t\t// Center horizontally on the dot\n\t\tlet left = linkRect.left + linkRect.width / 2 - popRect.width / 2;\n\n\t\t// Keep in viewport horizontally\n\t\tif (left < gap) left = gap;\n\t\tif (left + popRect.width > vw - gap) left = vw - popRect.width - gap;\n\n\t\t// Keep in viewport vertically\n\t\t// If popover would extend below viewport, show it above the dot instead\n\t\tif (top + popRect.height > vh - gap) {\n\t\t\ttop = linkRect.top - popRect.height - gap;\n\t\t}\n\t\t// If still not enough space, clamp to viewport top\n\t\tif (top < gap) top = gap;\n\n\t\t// Apply calculated position\n\t\tpopover.style.top = top + 'px';\n\t\tpopover.style.left = left + 'px';\n\t}\n\n\t/**\n\t * Close the active popover.\n\t *\n\t * Removes the popover and backdrop from the DOM with fade-out animation.\n\t * Cleans up event listeners to prevent memory leaks.\n\t *\n\t * Animation sequence:\n\t * 1. Remove 'is-active' class (triggers CSS fade-out)\n\t * 2. Wait 200ms for animation to complete\n\t * 3. Remove elements from DOM\n\t * 4. Clean up references\n\t *\n\t * @since 0.1.0\n\t *\n\t * @return {void}\n\t */\n\tfunction closePopover() {\n\t\tif (!activePopover) return;\n\n\t\t// Clean up event listeners\n\t\tif (activePopover._cleanup) activePopover._cleanup();\n\n\t\t// Start fade-out animation\n\t\tactivePopover.classList.remove('is-active');\n\t\tif (activeBackdrop) activeBackdrop.classList.remove('is-active');\n\n\t\t// Remove from DOM after animation completes\n\t\tsetTimeout(function() {\n\t\t\tif (activePopover && activePopover.parentNode) {\n\t\t\t\tactivePopover.parentNode.removeChild(activePopover);\n\t\t\t}\n\t\t\tif (activeBackdrop && activeBackdrop.parentNode) {\n\t\t\t\tactiveBackdrop.parentNode.removeChild(activeBackdrop);\n\t\t\t}\n\t\t\tactivePopover = null;\n\t\t\tactiveBackdrop = null;\n\t\t\tactiveCalendar = null;\n\t\t}, 200);\n\t}\n})();"],"names":["activePopover","activeBackdrop","activeCalendar","observer","visibilityMap","WeakMap","document","readyState","addEventListener","init","calendars","querySelectorAll","length","window","setupIntersectionObserver","forEach","calendar","set","setupCalendar","e","key","closePopover","IntersectionObserver","entries","entry","target","wasVisible","get","isVisible","isIntersecting","threshold","rootMargin","observe","events","eventLink","hasAttribute","setAttribute","preventDefault","stopPropagation","showPopover","content","innerHTML","customStyle","getAttribute","backdrop","createElement","className","body","appendChild","popover","closeBtn","positionPopover","setTimeout","classList","add","focus","updatePos","passive","_cleanup","removeEventListener","linkRect","getBoundingClientRect","popRect","vw","innerWidth","vh","innerHeight","gap","top","bottom","left","width","height","style","remove","parentNode","removeChild"],"ignoreList":[],"sourceRoot":""}