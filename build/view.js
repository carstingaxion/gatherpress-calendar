const e="is-active",t={popover:null,backdrop:null,calendar:null,triggerElement:null,cleanup:null},n=new WeakMap;let o=null;function r(e){o=e}function i(){return o}function c(e){return!0===n.get(e)}function a(e,t){const n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),r=window.innerWidth,i=window.innerHeight,c=10;let a=n.bottom+10,s=n.left+n.width/2-o.width/2;s<c&&(s=c),s+o.width>r-c&&(s=r-o.width-c),a+o.height>i-c&&(a=n.top-o.height-10),a<c&&(a=c),e.style.top=a+"px",e.style.left=s+"px"}function s(n,o){t.popover&&u();const r=n.getAttribute("data-event-content");if(!r)return;const i=document.getElementById(r);if(!i)return;const s=i.innerHTML;if(!s)return;const d=n.getAttribute("data-popover-style")||"",l=function(){const e=document.createElement("div");return e.className="gatherpress-calendar__backdrop",e.addEventListener("click",u),e}(),p=function(e,t){const n=document.createElement("div");return n.className="gatherpress-calendar__popover",n.setAttribute("role","dialog"),n.setAttribute("aria-modal","true"),n.setAttribute("tabindex","-1"),t&&n.setAttribute("style",t),n.innerHTML=e,n.appendChild(function(){const e=document.createElement("button");return e.className="gatherpress-calendar__popover-close",e.innerHTML="&times;",e.setAttribute("aria-label","Close"),e.addEventListener("click",u),e}()),n}(s,d);document.body.appendChild(l),document.body.appendChild(p),a(p,n),function(t,n){setTimeout(function(){n.classList.add(e),t.classList.add(e)},10)}(p,l),t.popover=p,t.backdrop=l,t.calendar=o,t.triggerElement=n,p.focus();const f=function(e,n,o){return function(){t.popover&&c(o)&&a(e,n)}}(p,n,o);window.addEventListener("scroll",f,{passive:!0}),window.addEventListener("resize",f,{passive:!0}),t.cleanup=function(){window.removeEventListener("scroll",f),window.removeEventListener("resize",f)}}function u(){if(!t.popover)return;const n=t.triggerElement;t.cleanup&&t.cleanup();const o=t.popover,r=t.backdrop;!function(t,n,o){t.classList.remove(e),n&&n.classList.remove(e),setTimeout(o,200)}(o,r,function(){o&&o.parentNode&&o.parentNode.removeChild(o),r&&r.parentNode&&r.parentNode.removeChild(r),t.popover=null,t.backdrop=null,t.calendar=null,t.triggerElement=null,t.cleanup=null,n&&"function"==typeof n.focus&&n.focus()})}function d(e){"Escape"===e.key&&t.popover&&u()}function l(e){e.querySelectorAll(".gatherpress-calendar__event").forEach(function(t){t.hasAttribute("data-setup")||(t.setAttribute("data-setup","true"),t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.addEventListener("click",function(n){!function(e,t,n){c(n)&&(e.preventDefault(),e.stopPropagation(),s(t,n))}(n,t,e)}),t.addEventListener("keydown",function(n){!function(e,t,n){c(n)&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),s(t,n)))}(n,t,e)}))})}!function(){function e(){const e=document.querySelectorAll(".gatherpress-calendar");e.length&&(function(e){"IntersectionObserver"in window?(r(new IntersectionObserver(function(e){e.forEach(function(e){const o=e.target,r=n.get(o),i=e.isIntersecting;n.set(o,i),i&&!r?l(o):!i&&r&&t.calendar===o&&u()})},{threshold:.1,rootMargin:"50px"})),e.forEach(function(e){const t=i();n.set(e,!1),t.observe(e)})):e.forEach(function(e){n.set(e,!0),l(e)})}(e),document.addEventListener("keydown",d))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e(),window.addEventListener("beforeunload",function(){u(),function(){const e=i();e&&(e.disconnect(),r(null))}()})}();