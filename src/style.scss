/**
 * GatherPress Calendar Block Styles
 *
 * CSS-first approach with progressive enhancement.
 * Leverages modern CSS features:
 * - Container queries for responsive behavior
 * - CSS Grid for layout
 * - Intrinsic sizing with clamp()
 * - aspect-ratio for consistent shapes
 *
 * @package GatherPressCalendar
 * @since 0.1.0
 */

/* ==========================================================================
   Calendar Wrapper
   ========================================================================== */

.gatherpress-calendar {
	width: 100%;
	max-width: var(--wp--style--global--wide-size, 1200px);
	margin-inline: auto;

	/* ======================================================================
	   Month Header
	   ====================================================================== */

	&__month {
		text-align: center;
		margin-block: 0 var(--wp--preset--spacing--40, 1rem);
		color: var(--wp--preset--color--contrast, #1e1e1e);
		line-height: 1.2;
	}

	/* ======================================================================
	   Calendar Table - CSS Grid Layout
	   ====================================================================== */

	&__table {
		width: 100%;
		display: grid;
		grid-template-columns: repeat(7, 1fr);
		gap: 1px;
		background: var(--wp--preset--color--contrast, #ddd);
		border: 1px solid var(--wp--preset--color--contrast, #ddd);
		container-type: inline-size;
		container-name: calendar;
		border-collapse: collapse;

		thead,
		tbody,
		tr {
			display: contents;
		}

		/* ==================================================================
		   Day Name Headers
		   ================================================================== */

		th {
			background: var(--wp--preset--color--base-2, #f8f9fa);
			color: var(--wp--preset--color--contrast, #495057);
			font-weight: 600;
			text-align: center;
			padding: clamp(0.5rem, 2vw, 0.75rem);
			font-size: clamp(0.625rem, 2vw, 0.875rem);
			text-transform: uppercase;
			letter-spacing: 0.05em;
			border: none;
			aspect-ratio: 1;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		/* ==================================================================
		   Day Cells - Square with aspect-ratio
		   ================================================================== */

		td {
			background: var(--wp--preset--color--base, #fff);
			position: relative;
			aspect-ratio: 1;
			min-height: 0;
			border: none;
			display: flex;
			align-items: stretch;
			justify-content: stretch;
			overflow: visible;

			&.is-empty {
				background: var(--wp--preset--color--base-2, #f8f9fa);
				opacity: 0.5;
			}

			/* ==============================================================
			   Today's Date Highlight
			   ============================================================== */

			&.is-today {
				background: rgba(0, 124, 186, 0.05);

				.gatherpress-calendar__day-number {
					color: var(--wp--preset--color--primary, #007cba);
					font-weight: 700;
					position: relative;

					&::after {
						content: "";
						position: absolute;
						bottom: -4px;
						left: 50%;
						transform: translateX(-50%);
						width: 20px;
						height: 2px;
						background: var(--wp--preset--color--primary, #007cba);
						border-radius: 1px;
					}
				}
			}

			/* ==============================================================
			   Days with Posts Highlight
			   ============================================================== */

			&.has-posts {
				background: rgba(0, 124, 186, 0.03);

				.gatherpress-calendar__day-number {
					color: var(--wp--preset--color--primary, #007cba);
					font-weight: 600;
					position: relative;

					&::after {
						content: "";
						position: absolute;
						bottom: -4px;
						left: 50%;
						transform: translateX(-50%);
						width: 16px;
						height: 2px;
						background: var(--wp--preset--color--primary, #007cba);
						border-radius: 1px;
						opacity: 0.6;
					}
				}
			}
		}
	}

	/* ======================================================================
	   Day Content Wrapper
	   ====================================================================== */

	&__day-content {
		width: 100%;
		height: 100%;
		display: flex;
		flex-direction: column;
		gap: clamp(0.25rem, 1vw, 0.5rem);
		padding: clamp(0.25rem, 1.5vw, 0.75rem);
		position: relative;
	}

	/* ==================================================================
	   Day Number
	   ================================================================== */

	/* stylelint-disable-next-line no-descending-specificity */
	&__day-number {
		font-weight: 600;
		font-size: clamp(0.75rem, 2vw, 0.875rem);
		color: var(--wp--preset--color--contrast, #495057);
		line-height: 1;
		text-align: center;
		flex-shrink: 0;
	}

	/* ==================================================================
	   Events Container
	   ================================================================== */

	&__events {
		display: flex;
		flex-wrap: wrap;
		gap: clamp(0.25rem, 1vw, 0.5rem);
		align-items: flex-start;
		justify-content: center;
		align-content: start;
		flex: 1;
		min-height: 0;
	}

	/* ==================================================================
	   Event Dots (Links)
	   ================================================================== */

	&__event {
		width: clamp(8px, 2.5vw, 12px);
		height: clamp(8px, 2.5vw, 12px);
		min-width: clamp(8px, 2.5vw, 12px);
		min-height: clamp(8px, 2.5vw, 12px);
		border-radius: 50%;
		background: var(--wp--preset--color--primary, #007cba);
		cursor: pointer;
		position: relative;
		transition: transform 0.2s ease, box-shadow 0.2s ease;
		flex-shrink: 0;
		display: inline-block;
		text-decoration: none;

		/* Hover state */
		&:hover {
			transform: scale(1.3);
			box-shadow: 0 0 0 3px rgba(0, 124, 186, 0.2);
		}

		/* Focus state for accessibility */
		&:focus-visible {
			outline: 2px solid var(--wp--preset--color--contrast, #007cba);
			outline-offset: 2px;
			transform: scale(1.3);
		}

		/* Color variations for multiple events */
		&:nth-child(2) {
			background: var(--wp--preset--color--secondary, #e65054);
		}

		&:nth-child(3) {
			background: var(--wp--preset--color--tertiary, #4ab866);
		}

		&:nth-child(4) {
			background: var(--wp--preset--color--vivid-purple, #9b51e0);
		}

		&:nth-child(5) {
			background: var(--wp--preset--color--vivid-cyan-blue, #0693e3);
		}

		&:nth-child(n+6) {
			background: var(--wp--preset--color--contrast, #666);
		}
	}

	/* ==================================================================
	   Hidden Event Content Containers
	   These hold the actual post content, hidden by default
	   ================================================================== */

	&__event-content {
		display: none;

		/* Ensure content is accessible to screen readers even when hidden */
		&[hidden] {
			display: none;
		}
	}

	/* ==================================================================
	   Popover (JavaScript-enhanced)
	   ================================================================== */

	&__popover {
		position: fixed;
		z-index: 1000;
		background: var(--wp--preset--color--base, #fff);
		border: 1px solid var(--wp--preset--color--contrast, #ddd);
		border-radius: 8px;
		box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
		padding: var(--wp--preset--spacing--40, 1rem);
		max-width: 350px;
		width: calc(100vw - 2rem);
		opacity: 0;
		pointer-events: none;
		transition: opacity 0.2s ease;

		&.is-active {
			opacity: 1;
			pointer-events: auto;
		}

		> * {
			margin-block: 0 var(--wp--preset--spacing--30, 0.75rem);
			color: var(--wp--preset--color--contrast, #1e1e1e);
			display: block !important;

			&:last-child {
				margin-block-end: 0;
			}
		}

		a {
			color: var(--wp--preset--color--primary, #007cba);
			text-decoration: none;

			&:hover {
				text-decoration: underline;
			}
		}
	}

	/* Close button */
	&__popover-close {
		position: absolute;
		top: 0.5rem;
		right: 0.5rem;
		background: transparent;
		border: none;
		cursor: pointer;
		padding: 0.25rem;
		color: var(--wp--preset--color--contrast, #666);
		font-size: 1.5rem;
		line-height: 1;
		transition: color 0.2s ease;

		&:hover {
			color: var(--wp--preset--color--contrast, #1e1e1e);
		}
	}

	/* Backdrop */
	&__backdrop {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		z-index: 999;
		background: rgba(0, 0, 0, 0.3);
		opacity: 0;
		pointer-events: none;
		transition: opacity 0.2s ease;

		&.is-active {
			opacity: 1;
			pointer-events: auto;
		}
	}

	/* ==================================================================
	   Template Config (Editor Only)
	   ================================================================== */

	&__template-config {
		display: none;
	}
}

/* ==========================================================================
   Block Container
   ========================================================================== */

.wp-block-gatherpress-calendar {
	padding: var(--wp--preset--spacing--50, 1rem);
	margin-block: var(--wp--preset--spacing--50, 1rem);

	/* ======================================================================
	   BLOCK STYLE: Minimal
	   ====================================================================== */

	&.is-style-minimal {

		.gatherpress-calendar__month {
			font-weight: 300;
			color: var(--wp--preset--color--contrast, #666);
		}

		.gatherpress-calendar__table {
			background: transparent;
			border: none;
			gap: 0;

			th {
				background: transparent;
				border-bottom: 1px solid var(--wp--preset--color--contrast, #e8e8e8);
				text-transform: none;
				letter-spacing: 0;
				font-weight: 300;
				color: var(--wp--preset--color--contrast, #999);
			}

			td {
				background: transparent;
				border-bottom: 1px solid var(--wp--preset--color--contrast, #f5f5f5);

				&.is-empty {
					opacity: 0.2;
				}

				&.is-today {
					background: transparent;

					.gatherpress-calendar__day-number {
						background: var(--wp--preset--color--primary, #007cba);
						color: #fff;
						width: clamp(24px, 5vw, 32px);
						height: clamp(24px, 5vw, 32px);
						display: flex;
						align-items: center;
						justify-content: center;
						border-radius: 50%;
						margin-inline: auto;
						font-weight: 300;

						&::after {
							display: none;
						}
					}
				}

				&.has-posts {
					background: transparent;

					.gatherpress-calendar__day-number::after {
						background: var(--wp--preset--color--contrast, #999);
						opacity: 0.5;
					}
				}
			}
		}

		/* stylelint-disable-next-line no-descending-specificity */
		.gatherpress-calendar__day-number {
			font-weight: 300;
			color: var(--wp--preset--color--contrast, #333);
		}

		.gatherpress-calendar__event {
			width: clamp(6px, 2vw, 8px);
			height: clamp(6px, 2vw, 8px);
			min-width: clamp(6px, 2vw, 8px);
			min-height: clamp(6px, 2vw, 8px);
			opacity: 0.7;

			&:hover {
				opacity: 1;
				transform: scale(1.5);
			}
		}
	}

	/* ======================================================================
	   BLOCK STYLE: Bold
	   ====================================================================== */

	&.is-style-bold {

		.gatherpress-calendar__month {
			font-weight: 900;
			text-transform: uppercase;
			letter-spacing: 0.1em;
			color: var(--wp--preset--color--contrast, #000);
			text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.1);
		}

		.gatherpress-calendar__table {
			gap: clamp(2px, 0.5vw, 4px);
			background: var(--wp--preset--color--contrast, #1e1e1e);
			border: clamp(2px, 0.5vw, 4px) solid var(--wp--preset--color--contrast, #1e1e1e);

			th {
				background: var(--wp--preset--color--contrast, #1e1e1e);
				color: var(--wp--preset--color--base, #fff);
				font-weight: 900;
				letter-spacing: 0.1em;
			}

			td {

				&.is-empty {
					background: var(--wp--preset--color--contrast, #333);
				}

				&.is-today {
					background: var(--wp--preset--color--primary, #007cba);
					box-shadow: inset 0 0 0 clamp(2px, 0.5vw, 4px) rgba(255, 255, 255, 0.3);

					.gatherpress-calendar__day-number {
						color: #fff;
						font-weight: 900;

						&::after {
							display: none;
						}
					}
				}

				&.has-posts .gatherpress-calendar__day-number::after {
					background: var(--wp--preset--color--primary, #007cba);
				}
			}
		}

		/* stylelint-disable-next-line no-descending-specificity */
		.gatherpress-calendar__day-number {
			font-weight: 900;
			color: var(--wp--preset--color--contrast, #1e1e1e);
		}

		/* stylelint-disable-next-line no-descending-specificity */
		.gatherpress-calendar__event {
			width: clamp(14px, 3vw, 18px);
			height: clamp(14px, 3vw, 18px);
			min-width: clamp(14px, 3vw, 18px);
			min-height: clamp(14px, 3vw, 18px);
			border: clamp(2px, 0.5vw, 3px) solid #fff;
			box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);

			&:hover {
				transform: scale(1.2) rotate(45deg);
			}
		}
	}

	/* ======================================================================
	   BLOCK STYLE: Circular
	   ====================================================================== */

	&.is-style-circular {

		.gatherpress-calendar__month {
			font-weight: 500;
			color: var(--wp--preset--color--primary, #007cba);
		}

		.gatherpress-calendar__table {
			gap: clamp(0.5rem, 2vw, 1rem);
			background: transparent;
			border: none;
			padding: clamp(0.5rem, 2vw, 1rem);

			th {
				background: transparent;
				border: none;
				color: var(--wp--preset--color--primary, #007cba);
				font-weight: 600;
				text-transform: none;
				border-radius: 50%;
			}

			td {
				border-radius: 50%;
				background: var(--wp--preset--color--base-2, #f0f4f8);
				border: 2px solid transparent;
				transition: all 0.3s ease;

				&.is-empty {
					background: transparent;
					opacity: 0.3;
				}

				&.has-posts {
					background: var(--wp--preset--color--base, #fff);
					border-color: var(--wp--preset--color--contrast, #d0dae5);
					box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);

					.gatherpress-calendar__day-number::after {
						background: var(--wp--preset--color--primary, #007cba);
					}
				}

				&.is-today {
					background: linear-gradient(135deg, var(--wp--preset--color--primary, #007cba) 0%, var(--wp--preset--color--secondary, #0693e3) 100%);
					border-color: var(--wp--preset--color--primary, #007cba);
					box-shadow: 0 4px 16px rgba(0, 124, 186, 0.3);

					.gatherpress-calendar__day-number {
						color: #fff;
						font-weight: 700;

						&::after {
							display: none;
						}
					}
				}
			}
		}

		/* stylelint-disable-next-line no-descending-specificity */
		.gatherpress-calendar__day-number {
			font-weight: 600;
		}

		/* stylelint-disable-next-line no-descending-specificity */
		.gatherpress-calendar__event {
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);

			&:hover {
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
				transform: scale(1.4);
			}
		}
	}

	/* ======================================================================
	   BLOCK STYLE: Gradient
	   ====================================================================== */

	&.is-style-gradient {
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		border-radius: 16px;
		padding: clamp(1rem, 4vw, 2rem);

		.gatherpress-calendar__month {
			font-weight: 700;
			color: #fff;
			text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
		}

		.gatherpress-calendar__table {
			gap: clamp(0.5rem, 1.5vw, 0.75rem);
			background: transparent;
			border: none;
			padding: clamp(0.5rem, 1.5vw, 0.75rem);

			th {
				background: rgba(255, 255, 255, 0.15);
				backdrop-filter: blur(10px);
				color: #fff;
				font-weight: 700;
				text-transform: uppercase;
				letter-spacing: 0.1em;
				border-radius: 8px;
				border: 1px solid rgba(255, 255, 255, 0.2);
			}

			td {
				background: rgba(255, 255, 255, 0.1);
				backdrop-filter: blur(10px);
				border: 1px solid rgba(255, 255, 255, 0.2);
				border-radius: 8px;
				transition: all 0.3s ease;

				&.is-empty {
					background: rgba(255, 255, 255, 0.05);
					opacity: 0.4;
				}

				&.has-posts {
					background: rgba(255, 255, 255, 0.2);
					border-color: rgba(255, 255, 255, 0.3);

					.gatherpress-calendar__day-number {
						color: #fff;

						&::after {
							background: #fff;
						}
					}
				}

				&.is-today {
					background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.2) 100%);
					border: 2px solid #fff;
					box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3), 0 0 0 4px rgba(255, 255, 255, 0.2);

					.gatherpress-calendar__day-number {
						color: #fff;
						font-weight: 900;
						text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);

						&::after {
							display: none;
						}
					}
				}
			}
		}

		/* stylelint-disable-next-line no-descending-specificity */
		.gatherpress-calendar__day-number {
			color: #fff;
			font-weight: 700;
			text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
		}

		/* stylelint-disable-next-line no-descending-specificity */
		.gatherpress-calendar__event {
			background: rgba(255, 255, 255, 0.9);
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
			border: 2px solid rgba(255, 255, 255, 0.5);

			&:hover {
				background: #fff;
				transform: scale(1.3);
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
			}

			/* Override color variations */
			&:nth-child(1),
			&:nth-child(2),
			&:nth-child(3),
			&:nth-child(4),
			&:nth-child(5),
			&:nth-child(n+6) {
				background: rgba(255, 255, 255, 0.9);
			}
		}
	}
}

/* ======================================================================
   Container Queries - Hide day names on narrow screens
   ====================================================================== */

@container calendar (max-width: 400px) {

	.gatherpress-calendar__table th {
		display: none;
	}

	.gatherpress-calendar__day-number {
		font-size: clamp(0.625rem, 1.5vw, 0.7rem);
	}

	.gatherpress-calendar__event {
		width: clamp(6px, 2vw, 8px);
		height: clamp(6px, 2vw, 8px);
		min-width: clamp(6px, 2vw, 8px);
		min-height: clamp(6px, 2vw, 8px);
	}

	.wp-block-gatherpress-calendar.is-style-bold .gatherpress-calendar__event {
		width: clamp(8px, 2.5vw, 10px);
		height: clamp(8px, 2.5vw, 10px);
		min-width: clamp(8px, 2.5vw, 10px);
		min-height: clamp(8px, 2.5vw, 10px);
	}
}

/* ======================================================================
   Traditional Responsive Fallback
   ====================================================================== */

@media (max-width: 400px) {

	@supports not (container-type: inline-size) {

		.gatherpress-calendar__table th {
			display: none;
		}

		.gatherpress-calendar__day-number {
			font-size: clamp(0.625rem, 1.5vw, 0.7rem);
		}

		.gatherpress-calendar__event {
			width: clamp(6px, 2vw, 8px);
			height: clamp(6px, 2vw, 8px);
			min-width: clamp(6px, 2vw, 8px);
			min-height: clamp(6px, 2vw, 8px);
		}
	}
}

/* ======================================================================
   Print Styles
   ====================================================================== */

@media print {

	.gatherpress-calendar__table {
		break-inside: avoid;

		td {
			break-inside: avoid;
		}
	}

	/* Hide event dots in print, show content containers instead */
	.gatherpress-calendar__event {
		display: none;
	}

	.gatherpress-calendar__event-content {
		display: block !important;
		margin-block-start: 0.5rem;
		padding: 0.5rem;
		border: 1px solid #ddd;
		border-radius: 4px;
		page-break-inside: avoid;

		> * {
			display: block !important;
		}
	}

	.gatherpress-calendar__backdrop,
	.gatherpress-calendar__popover {
		display: none;
	}
}
